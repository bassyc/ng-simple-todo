<!DOCTYPE html>
<html ng-app="todoApp">
<head>
    <title>TODO List</title>
    <link href="../css/bootstrap.css" rel="stylesheet"/>
    <link href="../css/bootstrap-theme.css" rel="stylesheet"/>

    <script src="../scripts/angular.js"></script>

    <script>
       var model = {
        user: "Jignesh",
        items:[
          {
            action: "Buy Flowers", done: false
          },
          {
              action: "Get Shoes", done: false
          },
          {
              action: "Collect Tickets", done: false
          }
        ]
       };

       var todoApp = angular.module("todoApp", []);

       todoApp.controller("ToDoController", function($scope) {
          $scope.todo = model;

          $scope.incompleteCount = function() {
            var count = 0;
            angular.forEach($scope.todo.items, function(item) {
              if (!item.done) { count++ };
            });
            return count;
          }

          $scope.warningLevel = function() {
            return $scope.incompleteCount() < 3 ? "label-success" : "label-warning"
          }

          /*
             This behavior allows the user to create new TODO items.This
             is an example of how behaviors and directives can be combined
             to respond to user interaction.

             This behavior takes the text of a new TODO item and adds an object
             to the data model, using the text as the value for "action" property
             and setting the "done" property to false.

             This is the first behavior which demonstrates modifying the model.
             But please note that in more complex applications there is usually
             a much more split between behaviors that obtain and prepare data
             for the view and those that respond to user interaction and update
             the model.

             When this gets invoked it updates the

               -> Data Table (created using ng-repeat directive) by appending
                  the newly added item in the end
               -> Incomplete Count in the Header by incrementing the current incomplete
                  count by 1

           THIS AGAIN DEMONSTRATES THAT ANGULARJS BINDINGS ARE DYNAMIC AND
           THE TWO-WAY MODEL BINDING UPDATES THE MODEL WHICH IN TURN UPDATES
           OTHER ELEMENTS THAT HAVE RELATED DATA BINDINGS.

           AND THIS LIVE MODEL IN ANGULARJS APP PROVIDES THE BENEFIT THAT
           YOUR BINDINGS AND BEHAVIORS CREATE A FOUNDATION OF FEATURES THAT
           WORK TOGETHER.

          */
          $scope.addNewItem = function(actionText) {
            // push behavior is in-built for Javascript's Array objects and
            // todo.items is an array.
            $scope.todo.items.push({ action: actionText, done: false });
          }
       });
    </script>
</head>
<body ng-controller="ToDoController">
    <div class="page-header">
        <h1>
            {{todo.user}}'s To Do List
            <span class="label label-default" ng-hide="incompleteCount() == 0"
                                              ng-class="warningLevel()">
                {{incompleteCount()}}
            </span>
         </h1>
    </div>

    <div class="panel">
        <div class="input-group">
            <!--
                New addition here is the ng-model directive.

                It is the same directive which was used earlier while setting-up
                check-boxes to demonstrate two-way model binding.

                Here the important point to note is that we have specified
                the name of a property, for the directive to update, that is
                not part of the model.

                The ng-model directive will dynamically create the property
                for us within the scope of the controller, effectively
                creating dynamic model properties that are used to handle
                user input.
            -->
            <input class="form-control" ng-model="actionText"/>
            <span class="input-group-btn">
                <!--
                   New addition here is the ng-click directive.

                   This directive sets up a handler that evaluates the expression
                   when the "click" event is triggered.In present case the
                   expression invokes the addNewItem behavior, which is passed
                   the dynamic "actionText" property (created above using ng-model
                   directive) as the argument.
                 -->
                <button class="btn btn-default"
                        ng-click="addNewItem(actionText)">
                    Add
                </button>
            </span>
        </div>

        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Description</th>
                    <th>Done</th>
                </tr>
            </thead>

            <tbody>
                <tr ng-repeat="item in todo.items">
                    <td>{{item.action}}</td>
                    <td>
                        <input type="checkbox" ng-model="item.done" />
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</body>
</html>