<!DOCTYPE html>
<html ng-app="todoApp">
<head>
    <title>TODO List</title>
    <link href="../css/bootstrap.css" rel="stylesheet"/>
    <link href="../css/bootstrap-theme.css" rel="stylesheet"/>

    <script src="../scripts/angular.js"></script>

    <script>
       var model = {
        user: "Jignesh",
        items:[
          {
            action: "Buy Flowers", done: false
          },
          {
              action: "Get Shoes", done: false
          },
          {
              action: "Collect Tickets", done: false
          }
        ]
       };

       var todoApp = angular.module("todoApp", []);

       /*
          Below is a custom filter.

          A custom filter is a filter "factory" which can be created by using
          "filter" method defined by AngularJS module object.The "filter" method
          returns a function that is used to filter a set of data objects.

          In present case the the function which does actual filtering and
          returned by "checkedItems" custom filter has two arguments:
           1. items
           2. showComplete

          The "items" argument will be provided by AngularJS and will be the set
          of objects that should be filtered.

          The "showComplete" argument will be passed when this filter will be
          used.
       */
       todoApp.filter("checkedItems", function() {
          return function(items, showComplete) {
              var resultArr = [];
              angular.forEach(items, function(item) {
                /*
                 * One might wonder at first glance why item.done == false
                 * check is present when this filter is meant to determine
                 * whether tasks that have been marked as done (item.done == true)
                 * will be included in the filtered data or not.
                 * There is a reason however for the
                 *   item.done == false
                 * check and it is that when initially the list will be rendered
                 * this filter gets applied but is passed showComplete as false
                 * which will result in displaying no items, if the
                 * item.done == false check is absent.
                 *
                 * On the other hand after the list rendering is done and
                 * user checks the "Show Complete" checkbox it will list all
                 * the items (marked/unmarked) which then makes using this
                 * filter useless.
                 *
                 */
                if (item.done == false || showComplete == true) {
                  resultArr.push(item);
                }
              });
              return resultArr;
          };
       });


       todoApp.controller("ToDoController", function($scope) {
          $scope.todo = model;

          $scope.incompleteCount = function() {
            var count = 0;
            angular.forEach($scope.todo.items, function(item) {
              if (!item.done) { count++ };
            });
            return count;
          }

          $scope.warningLevel = function() {
            return $scope.incompleteCount() < 3 ? "label-success" : "label-warning"
          }

          $scope.addNewItem = function(actionText) {
            $scope.todo.items.push({ action: actionText, done: false });
          }
       });

    </script>
</head>
<body ng-controller="ToDoController">
    <div class="page-header">
        <h1>
            {{todo.user}}'s To Do List
            <span class="label label-default" ng-hide="incompleteCount() == 0"
                                              ng-class="warningLevel()">
                {{incompleteCount()}}
            </span>
         </h1>
    </div>

    <div class="panel">
        <div class="input-group">
            <input class="form-control" ng-model="actionText"/>
            <span class="input-group-btn">
                <button class="btn btn-default"
                        ng-click="addNewItem(actionText)">
                    Add
                </button>
            </span>
        </div>

        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Description</th>
                    <th>Done</th>
                </tr>
            </thead>

            <tbody>
                <!--
                    New addition here is that filter
                        filter: { done: false }
                    is replaced with a custom filter:
                        checkedItems: showComplete

                    The syntax for using custom filters is the same as for
                    the built-in filtering support which is
                     <FILTER_NAME>
                       followed by : (COLON)
                       followed by the name of the model property or the decisive criteria property name
                       which is to be passed to the filter function.

                    The filter applied by filter: { done: false } works, but the
                    result is pretty useless because checked tasks are forever
                    hidden from the user.Thus we have created a custom filter
                    named "checkedItems" which basically determines whether tasks
                    that have been marked as done will be included in the
                    filtered data or not.
                 -->
                <tr ng-repeat="item in todo.items | checkedItems: showComplete | orderBy: 'action' ">
                    <td>{{item.action}}</td>
                    <td>
                        <input type="checkbox" ng-model="item.done" />
                    </td>
                </tr>
            </tbody>
        </table>

        <!--
            This check-box is a new addition here.
        -->
        <div class="checkbox-inline">
            <label>
                <!--
                  Here we have specified the name of a property, for the
                  ng-model directive to update, that is not part of the model.

                  The ng-model directive will dynamically create the property
                  for us within the scope of the controller, effectively
                  creating dynamic model properties that are used to handle
                  user input.

                  This is the same aspect which was demonstrated when the behavior
                  "addNewItem" was introduced to which a dynamic created
                  property "actionText" was passed as argument.
                 -->
                <input type="checkbox" ng-model="showComplete">
                Show Complete
            </label>
        </div>

    </div>
</body>
</html>